#!/usr/bin/env python3

from os import environ
from os.path import basename, dirname
from subprocess import run
from sys import argv, stderr


__dirname__ = dirname(__file__)
environ["PATH"] = ":".join(path
                           for path in environ["PATH"].split(":")
                           if path != __dirname__)


name = basename(argv[0])
args = argv[1:]

glob = {"--global", "-g"}
venv = environ.get("VIRTUAL_ENV") is not None
install = len(args) and args[0] == "install"

if install and not venv:
  if set(args).isdisjoint(glob):
    print(f"Not in VirtualENV | require: {' '.join(glob)}", file=stderr)
    exit(1)
  else:
    new_args = [arg for arg in args
                if arg not in glob]
    ret = run([name, *new_args])
    exit(ret.returncode)
else:
  ret = run([name, *args])
  exit(ret.returncode)
